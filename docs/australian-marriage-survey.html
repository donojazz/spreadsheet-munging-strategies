<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Spreadsheet Munging Strategies</title>
  <meta name="description" content="Spreadsheet Munging Strategies">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Spreadsheet Munging Strategies" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Spreadsheet Munging Strategies" />
  
  
  

<meta name="author" content="Duncan Garmonsway">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="case-studies.html">
<link rel="next" href="vaccinations.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-45097885-10"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-45097885-10');
</script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="chapter" data-level="1" data-path="setup.html"><a href="setup.html"><i class="fa fa-check"></i><b>1</b> Setup</a><ul>
<li class="chapter" data-level="1.1" data-path="packages.html"><a href="packages.html"><i class="fa fa-check"></i><b>1.1</b> Packages</a></li>
<li class="chapter" data-level="1.2" data-path="data.html"><a href="data.html"><i class="fa fa-check"></i><b>1.2</b> Data</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="tidyish.html"><a href="tidyish.html"><i class="fa fa-check"></i><b>2</b> Tidy-ish tables</a><ul>
<li class="chapter" data-level="2.1" data-path="tidy-clean.html"><a href="tidy-clean.html"><i class="fa fa-check"></i><b>2.1</b> Clean &amp; tidy tables</a></li>
<li class="chapter" data-level="2.2" data-path="almost-tidy-tables.html"><a href="almost-tidy-tables.html"><i class="fa fa-check"></i><b>2.2</b> Almost-tidy tables</a><ul>
<li class="chapter" data-level="2.2.1" data-path="almost-tidy-tables.html"><a href="almost-tidy-tables.html#transposed-headers-in-the-first-row-data-extends-to-the-right"><i class="fa fa-check"></i><b>2.2.1</b> Transposed (headers in the first row, data extends to the right)</a></li>
<li class="chapter" data-level="2.2.2" data-path="almost-tidy-tables.html"><a href="almost-tidy-tables.html#other-stuff-on-the-same-sheet"><i class="fa fa-check"></i><b>2.2.2</b> Other stuff on the same sheet</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="tidy-formatted-rows.html"><a href="tidy-formatted-rows.html"><i class="fa fa-check"></i><b>2.3</b> Meaningfully formatted rows</a></li>
<li class="chapter" data-level="2.4" data-path="tidy-formatted-cells.html"><a href="tidy-formatted-cells.html"><i class="fa fa-check"></i><b>2.4</b> Meaningfully formatted cells</a></li>
<li class="chapter" data-level="2.5" data-path="layered-formatting.html"><a href="layered-formatting.html"><i class="fa fa-check"></i><b>2.5</b> Layered meaningful formatting</a></li>
<li class="chapter" data-level="2.6" data-path="hierarchies-in-formatting.html"><a href="hierarchies-in-formatting.html"><i class="fa fa-check"></i><b>2.6</b> Hierarchies in formatting</a></li>
<li class="chapter" data-level="2.7" data-path="tidy-sentinel.html"><a href="tidy-sentinel.html"><i class="fa fa-check"></i><b>2.7</b> Sentinel values in non-text columns</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="pivot.html"><a href="pivot.html"><i class="fa fa-check"></i><b>3</b> Pivot tables</a><ul>
<li class="chapter" data-level="3.1" data-path="pivot-simple.html"><a href="pivot-simple.html"><i class="fa fa-check"></i><b>3.1</b> Simple unpivoting</a><ul>
<li class="chapter" data-level="3.1.1" data-path="pivot-simple.html"><a href="pivot-simple.html#two-clear-rows-of-text-column-headers-left-aligned"><i class="fa fa-check"></i><b>3.1.1</b> Two clear rows of text column headers, left-aligned</a></li>
<li class="chapter" data-level="3.1.2" data-path="pivot-simple.html"><a href="pivot-simple.html#two-clear-rows-and-columns-of-text-headers-top-aligned-and-left-aligned"><i class="fa fa-check"></i><b>3.1.2</b> Two clear rows and columns of text headers, top-aligned and left-aligned</a></li>
<li class="chapter" data-level="3.1.3" data-path="pivot-simple.html"><a href="pivot-simple.html#multiple-rows-or-columns-of-headers-with-meaningful-formatting"><i class="fa fa-check"></i><b>3.1.3</b> Multiple rows or columns of headers, with meaningful formatting</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="pivot-complex.html"><a href="pivot-complex.html"><i class="fa fa-check"></i><b>3.2</b> Complex unpivoting</a><ul>
<li class="chapter" data-level="3.2.1" data-path="pivot-complex.html"><a href="pivot-complex.html#two-clear-rows-of-text-column-headers-left-aligned-2rl"><i class="fa fa-check"></i><b>3.2.1</b> Two clear rows of text column headers, left-aligned {#2RL}</a></li>
<li class="chapter" data-level="3.2.2" data-path="pivot-complex.html"><a href="pivot-complex.html#two-clear-columns-of-text-row-headers-top-aligned"><i class="fa fa-check"></i><b>3.2.2</b> Two clear columns of text row headers, top-aligned</a></li>
<li class="chapter" data-level="3.2.3" data-path="pivot-complex.html"><a href="pivot-complex.html#two-clear-rows-and-columns-of-text-headers-top-aligned-and-left-aligned-1"><i class="fa fa-check"></i><b>3.2.3</b> Two clear rows and columns of text headers, top-aligned and left-aligned</a></li>
<li class="chapter" data-level="3.2.4" data-path="pivot-complex.html"><a href="pivot-complex.html#centre-aligned-headers"><i class="fa fa-check"></i><b>3.2.4</b> Centre-aligned headers</a></li>
<li class="chapter" data-level="3.2.5" data-path="pivot-complex.html"><a href="pivot-complex.html#multiple-rows-or-columns-of-headers-with-meaningful-formatting-1"><i class="fa fa-check"></i><b>3.2.5</b> Multiple rows or columns of headers, with meaningful formatting</a></li>
<li class="chapter" data-level="3.2.6" data-path="pivot-complex.html"><a href="pivot-complex.html#mixed-headers-and-notes-in-the-same-rowcolumn-distinguished-by-formatting"><i class="fa fa-check"></i><b>3.2.6</b> Mixed headers and notes in the same row/column, distinguished by formatting</a></li>
<li class="chapter" data-level="3.2.7" data-path="pivot-complex.html"><a href="pivot-complex.html#mixed-levels-of-headers-in-the-same-rowcolumn-distinguished-by-formatting"><i class="fa fa-check"></i><b>3.2.7</b> Mixed levels of headers in the same row/column, distinguished by formatting</a></li>
<li class="chapter" data-level="3.2.8" data-path="pivot-complex.html"><a href="pivot-complex.html#repeated-rowscolumns-of-headers-within-the-table"><i class="fa fa-check"></i><b>3.2.8</b> Repeated rows/columns of headers within the table</a></li>
<li class="chapter" data-level="3.2.9" data-path="pivot-complex.html"><a href="pivot-complex.html#headers-amongst-the-data"><i class="fa fa-check"></i><b>3.2.9</b> Headers amongst the data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="small-multiples.html"><a href="small-multiples.html"><i class="fa fa-check"></i><b>4</b> Small multiples</a><ul>
<li class="chapter" data-level="4.1" data-path="small-multiples-with-all-headers-present-for-each-multiple.html"><a href="small-multiples-with-all-headers-present-for-each-multiple.html"><i class="fa fa-check"></i><b>4.1</b> Small multiples with all headers present for each multiple</a></li>
<li class="chapter" data-level="4.2" data-path="same-table-in-several-worksheetsfiles-using-the-sheetfile-name.html"><a href="same-table-in-several-worksheetsfiles-using-the-sheetfile-name.html"><i class="fa fa-check"></i><b>4.2</b> Same table in several worksheets/files (using the sheet/file name)</a></li>
<li class="chapter" data-level="4.3" data-path="same-table-in-several-worksheetsfiles-but-in-different-positions.html"><a href="same-table-in-several-worksheetsfiles-but-in-different-positions.html"><i class="fa fa-check"></i><b>4.3</b> Same table in several worksheets/files but in different positions</a></li>
<li class="chapter" data-level="4.4" data-path="implied-multiples.html"><a href="implied-multiples.html"><i class="fa fa-check"></i><b>4.4</b> Implied multiples</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="formatting.html"><a href="formatting.html"><i class="fa fa-check"></i><b>5</b> Formatting</a><ul>
<li class="chapter" data-level="5.1" data-path="an-example-formatting-lookup.html"><a href="an-example-formatting-lookup.html"><i class="fa fa-check"></i><b>5.1</b> An example formatting lookup</a></li>
<li class="chapter" data-level="5.2" data-path="common-formats.html"><a href="common-formats.html"><i class="fa fa-check"></i><b>5.2</b> Common formats</a></li>
<li class="chapter" data-level="5.3" data-path="in-cell-formatting.html"><a href="in-cell-formatting.html"><i class="fa fa-check"></i><b>5.3</b> In-cell formatting</a></li>
<li class="chapter" data-level="5.4" data-path="multiple-pieces-of-information-in-a-single-cell-with-meaningful-formatting.html"><a href="multiple-pieces-of-information-in-a-single-cell-with-meaningful-formatting.html"><i class="fa fa-check"></i><b>5.4</b> Multiple pieces of information in a single cell, with meaningful formatting</a></li>
<li class="chapter" data-level="5.5" data-path="superscript-symbols.html"><a href="superscript-symbols.html"><i class="fa fa-check"></i><b>5.5</b> Superscript symbols</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="data-validation.html"><a href="data-validation.html"><i class="fa fa-check"></i><b>6</b> Data validation</a></li>
<li class="chapter" data-level="7" data-path="formulas.html"><a href="formulas.html"><i class="fa fa-check"></i><b>7</b> Formulas</a></li>
<li class="chapter" data-level="8" data-path="other-gotchas.html"><a href="other-gotchas.html"><i class="fa fa-check"></i><b>8</b> Other gotchas</a><ul>
<li class="chapter" data-level="8.1" data-path="non-text-headers-e-g-dates.html"><a href="non-text-headers-e-g-dates.html"><i class="fa fa-check"></i><b>8.1</b> Non-text headers e.g. dates</a></li>
<li class="chapter" data-level="8.2" data-path="data-embedded-in-comments.html"><a href="data-embedded-in-comments.html"><i class="fa fa-check"></i><b>8.2</b> Data embedded in comments</a></li>
<li class="chapter" data-level="8.3" data-path="named-ranges.html"><a href="named-ranges.html"><i class="fa fa-check"></i><b>8.3</b> Named ranges</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="case-studies.html"><a href="case-studies.html"><i class="fa fa-check"></i><b>9</b> Case studies</a><ul>
<li class="chapter" data-level="9.1" data-path="australian-marriage-survey.html"><a href="australian-marriage-survey.html"><i class="fa fa-check"></i><b>9.1</b> Australian Marriage Survey</a><ul>
<li class="chapter" data-level="9.1.1" data-path="australian-marriage-survey.html"><a href="australian-marriage-survey.html#the-full-code-listing"><i class="fa fa-check"></i><b>9.1.1</b> The full code listing</a></li>
<li class="chapter" data-level="9.1.2" data-path="australian-marriage-survey.html"><a href="australian-marriage-survey.html#step-by-step"><i class="fa fa-check"></i><b>9.1.2</b> Step by step</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="vaccinations.html"><a href="vaccinations.html"><i class="fa fa-check"></i><b>9.2</b> Vaccinations</a></li>
<li class="chapter" data-level="9.3" data-path="us-crime.html"><a href="us-crime.html"><i class="fa fa-check"></i><b>9.3</b> US Crime</a><ul>
<li class="chapter" data-level="9.3.1" data-path="us-crime.html"><a href="us-crime.html#us-crime-2"><i class="fa fa-check"></i><b>9.3.1</b> Table 2</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="toronto-transit-commission.html"><a href="toronto-transit-commission.html"><i class="fa fa-check"></i><b>9.4</b> Toronto Transit Commission</a><ul>
<li class="chapter" data-level="9.4.1" data-path="toronto-transit-commission.html"><a href="toronto-transit-commission.html#the-full-code-listing-1"><i class="fa fa-check"></i><b>9.4.1</b> The full code listing</a></li>
<li class="chapter" data-level="9.4.2" data-path="toronto-transit-commission.html"><a href="toronto-transit-commission.html#step-by-step-1"><i class="fa fa-check"></i><b>9.4.2</b> Step by step</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Spreadsheet Munging Strategies</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="australian-marriage-survey" class="section level2">
<h2><span class="header-section-number">9.1</span> Australian Marriage Survey</h2>
<p><a href="https://twitter.com/MilesMcBain/status/932257990253645829"><img src="images/ozmarriage_tweet.png" alt="Tweet by Miles McBain about tidying the Australian Marriage Survey results with R" /></a></p>
<p>These are the results of a survey in 2017 by the Australian Bureau of Statistics
that asked, “Should the law be changed to allow same-sex couples to marry?”</p>
<p>There are two tables with structures that are similar but different. <a href="https://github.com/nacnudus/smungs/blob/master/inst/extdata/ozmarriage.xlsx?raw=true">Download
the
file</a>.
<a href="http://www.abs.gov.au/ausstats/abs@.nsf/mf/1800.0">Original source</a>.</p>
<p><img src="images/ozmarriage1.png" /></p>
<p><img src="images/ozmarriage2.png" /></p>
<div id="the-full-code-listing" class="section level3">
<h3><span class="header-section-number">9.1.1</span> The full code listing</h3>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb331-1" data-line-number="1">cells &lt;-<span class="st"> </span><span class="kw">xlsx_cells</span>(smungs<span class="op">::</span>ozmarriage)</a>
<a class="sourceLine" id="cb331-2" data-line-number="2">formats &lt;-<span class="st"> </span><span class="kw">xlsx_formats</span>(smungs<span class="op">::</span>ozmarriage)</a>
<a class="sourceLine" id="cb331-3" data-line-number="3"></a>
<a class="sourceLine" id="cb331-4" data-line-number="4">table_<span class="dv">1</span>  &lt;-</a>
<a class="sourceLine" id="cb331-5" data-line-number="5"><span class="st">  </span>cells <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb331-6" data-line-number="6"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(sheet <span class="op">==</span><span class="st"> &quot;Table 1&quot;</span>, row <span class="op">&gt;=</span><span class="st"> </span>5L, <span class="op">!</span>is_blank) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb331-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">character =</span> <span class="kw">str_trim</span>(character)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb331-8" data-line-number="8"><span class="st">  </span><span class="kw">behead</span>(<span class="st">&quot;NNW&quot;</span>, <span class="st">&quot;population&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb331-9" data-line-number="9"><span class="st">  </span><span class="kw">behead</span>(<span class="st">&quot;NNW&quot;</span>, <span class="st">&quot;response&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb331-10" data-line-number="10"><span class="st">  </span><span class="kw">behead</span>(<span class="st">&quot;N&quot;</span>, <span class="st">&quot;unit&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb331-11" data-line-number="11"><span class="st">  </span><span class="kw">behead</span>(<span class="st">&quot;W&quot;</span>, <span class="st">&quot;state&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb331-12" data-line-number="12"><span class="st">  </span><span class="kw">arrange</span>(row, col) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb331-13" data-line-number="13"><span class="st">  </span><span class="kw">select</span>(row, data_type, numeric, state, population, response, unit) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb331-14" data-line-number="14"><span class="st">  </span><span class="kw">spatter</span>(unit) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb331-15" data-line-number="15"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>row)</a>
<a class="sourceLine" id="cb331-16" data-line-number="16"></a>
<a class="sourceLine" id="cb331-17" data-line-number="17">state &lt;-</a>
<a class="sourceLine" id="cb331-18" data-line-number="18"><span class="st">  </span>cells <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb331-19" data-line-number="19"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(sheet <span class="op">==</span><span class="st"> &quot;Table 2&quot;</span>,</a>
<a class="sourceLine" id="cb331-20" data-line-number="20">                row <span class="op">&gt;=</span><span class="st"> </span>5L,</a>
<a class="sourceLine" id="cb331-21" data-line-number="21">                col <span class="op">==</span><span class="st"> </span>1L,</a>
<a class="sourceLine" id="cb331-22" data-line-number="22">                <span class="op">!</span>is_blank,</a>
<a class="sourceLine" id="cb331-23" data-line-number="23">                formats<span class="op">$</span>local<span class="op">$</span>font<span class="op">$</span>bold[local_format_id]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb331-24" data-line-number="24"><span class="st">  </span><span class="kw">select</span>(row, col, <span class="dt">state =</span> character)</a>
<a class="sourceLine" id="cb331-25" data-line-number="25"></a>
<a class="sourceLine" id="cb331-26" data-line-number="26">table_<span class="dv">2</span> &lt;-</a>
<a class="sourceLine" id="cb331-27" data-line-number="27"><span class="st">  </span>cells <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb331-28" data-line-number="28"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(sheet <span class="op">==</span><span class="st"> &quot;Table 2&quot;</span>,</a>
<a class="sourceLine" id="cb331-29" data-line-number="29">                row <span class="op">&gt;=</span><span class="st"> </span>5L,</a>
<a class="sourceLine" id="cb331-30" data-line-number="30">                <span class="op">!</span>is_blank) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb331-31" data-line-number="31"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">character =</span> <span class="kw">str_trim</span>(character)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb331-32" data-line-number="32"><span class="st">  </span><span class="kw">behead</span>(<span class="st">&quot;NNW&quot;</span>, <span class="st">&quot;population&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb331-33" data-line-number="33"><span class="st">  </span><span class="kw">behead</span>(<span class="st">&quot;NNW&quot;</span>, <span class="st">&quot;response&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb331-34" data-line-number="34"><span class="st">  </span><span class="kw">behead</span>(<span class="st">&quot;N&quot;</span>, <span class="st">&quot;unit&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb331-35" data-line-number="35"><span class="st">  </span><span class="kw">behead</span>(<span class="st">&quot;W&quot;</span>, <span class="st">&quot;territory&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb331-36" data-line-number="36"><span class="st">  </span><span class="kw">enhead</span>(state, <span class="st">&quot;NNW&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb331-37" data-line-number="37"><span class="st">  </span><span class="kw">arrange</span>(row, col) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb331-38" data-line-number="38"><span class="st">  </span><span class="kw">select</span>(row, data_type, numeric, state, territory, population, response,</a>
<a class="sourceLine" id="cb331-39" data-line-number="39">         unit) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb331-40" data-line-number="40"><span class="st">  </span><span class="kw">spatter</span>(unit) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb331-41" data-line-number="41"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>row)</a>
<a class="sourceLine" id="cb331-42" data-line-number="42"></a>
<a class="sourceLine" id="cb331-43" data-line-number="43">all_tables &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(<span class="st">&quot;Table 1&quot;</span> =<span class="st"> </span>table_<span class="dv">1</span>, <span class="st">&quot;Table 2&quot;</span> =<span class="st"> </span>table_<span class="dv">2</span>, <span class="dt">.id =</span> <span class="st">&quot;sheet&quot;</span>)</a>
<a class="sourceLine" id="cb331-44" data-line-number="44">all_tables</a></code></pre></div>
<pre><code>## # A tibble: 1,176 x 7
##    sheet   state           population    response     `%`    no. territory
##    &lt;chr&gt;   &lt;chr&gt;           &lt;chr&gt;         &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;    
##  1 Table 1 New South Wales Eligible Par… Non-respo…  20.5 1.07e6 &lt;NA&gt;     
##  2 Table 1 New South Wales Eligible Par… Response …  79.2 4.11e6 &lt;NA&gt;     
##  3 Table 1 New South Wales Eligible Par… Response …   0.2 1.10e4 &lt;NA&gt;     
##  4 Table 1 New South Wales Eligible Par… Total      100   5.19e6 &lt;NA&gt;     
##  5 Table 1 New South Wales Response cle… No          42.2 1.74e6 &lt;NA&gt;     
##  6 Table 1 New South Wales Response cle… Total      100   4.11e6 &lt;NA&gt;     
##  7 Table 1 New South Wales Response cle… Yes         57.8 2.37e6 &lt;NA&gt;     
##  8 Table 1 Victoria        Eligible Par… Non-respo…  18.3 7.44e5 &lt;NA&gt;     
##  9 Table 1 Victoria        Eligible Par… Response …  81.4 3.31e6 &lt;NA&gt;     
## 10 Table 1 Victoria        Eligible Par… Response …   0.3 1.10e4 &lt;NA&gt;     
## # ... with 1,166 more rows</code></pre>
</div>
<div id="step-by-step" class="section level3">
<h3><span class="header-section-number">9.1.2</span> Step by step</h3>
<div id="table-1" class="section level4">
<h4><span class="header-section-number">9.1.2.1</span> Table 1</h4>
<p>The first rows, up to the column-headers, must be filtered out. The trailing
rows below the table will be treated us row-headers, but because there is no
data to join them to, they will be dropped automatically. That is handy,
because otherwise we would have to know where the bottom of the table is, which
is likely to change with later editions of the same data.</p>
<p>Apart from filtering the first rows, the rest of this example is ‘textbook’.</p>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb333-1" data-line-number="1">cells &lt;-<span class="st"> </span><span class="kw">xlsx_cells</span>(smungs<span class="op">::</span>ozmarriage)</a>
<a class="sourceLine" id="cb333-2" data-line-number="2"></a>
<a class="sourceLine" id="cb333-3" data-line-number="3">table_<span class="dv">1</span>  &lt;-</a>
<a class="sourceLine" id="cb333-4" data-line-number="4"><span class="st">  </span>cells <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb333-5" data-line-number="5"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(sheet <span class="op">==</span><span class="st"> &quot;Table 1&quot;</span>, row <span class="op">&gt;=</span><span class="st"> </span>5L, <span class="op">!</span>is_blank) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb333-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">character =</span> <span class="kw">str_trim</span>(character)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb333-7" data-line-number="7"><span class="st">  </span><span class="kw">behead</span>(<span class="st">&quot;NNW&quot;</span>, <span class="st">&quot;population&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb333-8" data-line-number="8"><span class="st">  </span><span class="kw">behead</span>(<span class="st">&quot;NNW&quot;</span>, <span class="st">&quot;response&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb333-9" data-line-number="9"><span class="st">  </span><span class="kw">behead</span>(<span class="st">&quot;N&quot;</span>, <span class="st">&quot;unit&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb333-10" data-line-number="10"><span class="st">  </span><span class="kw">behead</span>(<span class="st">&quot;W&quot;</span>, <span class="st">&quot;state&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb333-11" data-line-number="11"><span class="st">  </span><span class="kw">arrange</span>(row, col) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb333-12" data-line-number="12"><span class="st">  </span><span class="kw">select</span>(row, data_type, numeric, state, population, response, unit) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb333-13" data-line-number="13"><span class="st">  </span><span class="kw">spatter</span>(unit) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb333-14" data-line-number="14"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>row)</a>
<a class="sourceLine" id="cb333-15" data-line-number="15"></a>
<a class="sourceLine" id="cb333-16" data-line-number="16">table_<span class="dv">1</span></a></code></pre></div>
<pre><code>## # A tibble: 63 x 5
##    state           population            response               `%`    no.
##    &lt;chr&gt;           &lt;chr&gt;                 &lt;chr&gt;                &lt;dbl&gt;  &lt;dbl&gt;
##  1 New South Wales Eligible Participants Non-responding        20.5 1.07e6
##  2 New South Wales Eligible Participants Response clear        79.2 4.11e6
##  3 New South Wales Eligible Participants Response not clear(…   0.2 1.10e4
##  4 New South Wales Eligible Participants Total                100   5.19e6
##  5 New South Wales Response clear        No                    42.2 1.74e6
##  6 New South Wales Response clear        Total                100   4.11e6
##  7 New South Wales Response clear        Yes                   57.8 2.37e6
##  8 Victoria        Eligible Participants Non-responding        18.3 7.44e5
##  9 Victoria        Eligible Participants Response clear        81.4 3.31e6
## 10 Victoria        Eligible Participants Response not clear(…   0.3 1.10e4
## # ... with 53 more rows</code></pre>
</div>
<div id="table-2" class="section level4">
<h4><span class="header-section-number">9.1.2.2</span> Table 2</h4>
<p>This is like Table 1, broken down by division rather than by state. The snag is
that the states are named in the same column as their divisions. Because the
state names are formatted in bold, we can isolate them from the division names.
With them out of the way, unpivot the rest of the table as normal, and then use
<code>enhead()</code> at the end to join the state names back on.</p>
<p>Since tables 1 and 2 are so similar structurally, they might as well be joined
into one.</p>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb335-1" data-line-number="1">cells &lt;-<span class="st"> </span><span class="kw">xlsx_cells</span>(smungs<span class="op">::</span>ozmarriage)</a>
<a class="sourceLine" id="cb335-2" data-line-number="2">formats &lt;-<span class="st"> </span><span class="kw">xlsx_formats</span>(smungs<span class="op">::</span>ozmarriage)</a>
<a class="sourceLine" id="cb335-3" data-line-number="3"></a>
<a class="sourceLine" id="cb335-4" data-line-number="4">state &lt;-</a>
<a class="sourceLine" id="cb335-5" data-line-number="5"><span class="st">  </span>cells <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb335-6" data-line-number="6"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(sheet <span class="op">==</span><span class="st"> &quot;Table 2&quot;</span>,</a>
<a class="sourceLine" id="cb335-7" data-line-number="7">                row <span class="op">&gt;=</span><span class="st"> </span>5L,</a>
<a class="sourceLine" id="cb335-8" data-line-number="8">                col <span class="op">==</span><span class="st"> </span>1L,</a>
<a class="sourceLine" id="cb335-9" data-line-number="9">                <span class="op">!</span>is_blank,</a>
<a class="sourceLine" id="cb335-10" data-line-number="10">                formats<span class="op">$</span>local<span class="op">$</span>font<span class="op">$</span>bold[local_format_id]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb335-11" data-line-number="11"><span class="st">  </span><span class="kw">select</span>(row, col, <span class="dt">state =</span> character)</a>
<a class="sourceLine" id="cb335-12" data-line-number="12"></a>
<a class="sourceLine" id="cb335-13" data-line-number="13">table_<span class="dv">2</span> &lt;-</a>
<a class="sourceLine" id="cb335-14" data-line-number="14"><span class="st">  </span>cells <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb335-15" data-line-number="15"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(sheet <span class="op">==</span><span class="st"> &quot;Table 2&quot;</span>,</a>
<a class="sourceLine" id="cb335-16" data-line-number="16">                row <span class="op">&gt;=</span><span class="st"> </span>5L,</a>
<a class="sourceLine" id="cb335-17" data-line-number="17">                <span class="op">!</span>is_blank) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb335-18" data-line-number="18"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">character =</span> <span class="kw">str_trim</span>(character)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb335-19" data-line-number="19"><span class="st">  </span><span class="kw">behead</span>(<span class="st">&quot;NNW&quot;</span>, <span class="st">&quot;population&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb335-20" data-line-number="20"><span class="st">  </span><span class="kw">behead</span>(<span class="st">&quot;NNW&quot;</span>, <span class="st">&quot;response&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb335-21" data-line-number="21"><span class="st">  </span><span class="kw">behead</span>(<span class="st">&quot;N&quot;</span>, <span class="st">&quot;unit&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb335-22" data-line-number="22"><span class="st">  </span><span class="kw">behead</span>(<span class="st">&quot;W&quot;</span>, <span class="st">&quot;territory&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb335-23" data-line-number="23"><span class="st">  </span><span class="kw">enhead</span>(state, <span class="st">&quot;NNW&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb335-24" data-line-number="24"><span class="st">  </span><span class="kw">arrange</span>(row, col) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb335-25" data-line-number="25"><span class="st">  </span><span class="kw">select</span>(row, data_type, numeric, state, territory, population, response,</a>
<a class="sourceLine" id="cb335-26" data-line-number="26">         unit) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb335-27" data-line-number="27"><span class="st">  </span><span class="kw">spatter</span>(unit) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb335-28" data-line-number="28"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>row)</a>
<a class="sourceLine" id="cb335-29" data-line-number="29"></a>
<a class="sourceLine" id="cb335-30" data-line-number="30">all_tables &lt;-</a>
<a class="sourceLine" id="cb335-31" data-line-number="31"><span class="st">  </span><span class="kw">bind_rows</span>(<span class="st">&quot;Table 1&quot;</span> =<span class="st"> </span>table_<span class="dv">1</span>, <span class="st">&quot;Table 2&quot;</span> =<span class="st"> </span>table_<span class="dv">2</span>, <span class="dt">.id =</span> <span class="st">&quot;sheet&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb335-32" data-line-number="32"><span class="st">  </span><span class="kw">select</span>(sheet, state, territory, population, response, <span class="st">`</span><span class="dt">%</span><span class="st">`</span>, no.)</a>
<a class="sourceLine" id="cb335-33" data-line-number="33">all_tables</a></code></pre></div>
<pre><code>## # A tibble: 1,176 x 7
##    sheet   state           territory population    response     `%`    no.
##    &lt;chr&gt;   &lt;chr&gt;           &lt;chr&gt;     &lt;chr&gt;         &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt;
##  1 Table 1 New South Wales &lt;NA&gt;      Eligible Par… Non-respo…  20.5 1.07e6
##  2 Table 1 New South Wales &lt;NA&gt;      Eligible Par… Response …  79.2 4.11e6
##  3 Table 1 New South Wales &lt;NA&gt;      Eligible Par… Response …   0.2 1.10e4
##  4 Table 1 New South Wales &lt;NA&gt;      Eligible Par… Total      100   5.19e6
##  5 Table 1 New South Wales &lt;NA&gt;      Response cle… No          42.2 1.74e6
##  6 Table 1 New South Wales &lt;NA&gt;      Response cle… Total      100   4.11e6
##  7 Table 1 New South Wales &lt;NA&gt;      Response cle… Yes         57.8 2.37e6
##  8 Table 1 Victoria        &lt;NA&gt;      Eligible Par… Non-respo…  18.3 7.44e5
##  9 Table 1 Victoria        &lt;NA&gt;      Eligible Par… Response …  81.4 3.31e6
## 10 Table 1 Victoria        &lt;NA&gt;      Eligible Par… Response …   0.3 1.10e4
## # ... with 1,166 more rows</code></pre>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="case-studies.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="vaccinations.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/nacnudus/spreadsheet-munging-strategies/edit/master/case-studies.Rmd",
"text": "Edit"
},
"download": ["_main.pdf", "_main.epub"],
"toc": {
"collapse": "none"
}
});
});
</script>

</body>

</html>
