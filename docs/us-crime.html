<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Spreadsheet Munging Strategies</title>
  <meta name="description" content="Spreadsheet Munging Strategies">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Spreadsheet Munging Strategies" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Spreadsheet Munging Strategies" />
  
  
  

<meta name="author" content="Duncan Garmonsway">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="vaccinations.html">
<link rel="next" href="toronto-transit-commission.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-45097885-10"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-45097885-10');
</script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="chapter" data-level="1" data-path="setup.html"><a href="setup.html"><i class="fa fa-check"></i><b>1</b> Setup</a><ul>
<li class="chapter" data-level="1.1" data-path="packages.html"><a href="packages.html"><i class="fa fa-check"></i><b>1.1</b> Packages</a></li>
<li class="chapter" data-level="1.2" data-path="data.html"><a href="data.html"><i class="fa fa-check"></i><b>1.2</b> Data</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="tidyish.html"><a href="tidyish.html"><i class="fa fa-check"></i><b>2</b> Tidy-ish tables</a><ul>
<li class="chapter" data-level="2.1" data-path="tidy-clean.html"><a href="tidy-clean.html"><i class="fa fa-check"></i><b>2.1</b> Clean &amp; tidy tables</a></li>
<li class="chapter" data-level="2.2" data-path="almost-tidy-tables.html"><a href="almost-tidy-tables.html"><i class="fa fa-check"></i><b>2.2</b> Almost-tidy tables</a><ul>
<li class="chapter" data-level="2.2.1" data-path="almost-tidy-tables.html"><a href="almost-tidy-tables.html#transposed-headers-in-the-first-row-data-extends-to-the-right"><i class="fa fa-check"></i><b>2.2.1</b> Transposed (headers in the first row, data extends to the right)</a></li>
<li class="chapter" data-level="2.2.2" data-path="almost-tidy-tables.html"><a href="almost-tidy-tables.html#other-stuff-on-the-same-sheet"><i class="fa fa-check"></i><b>2.2.2</b> Other stuff on the same sheet</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="tidy-formatted-rows.html"><a href="tidy-formatted-rows.html"><i class="fa fa-check"></i><b>2.3</b> Meaningfully formatted rows</a></li>
<li class="chapter" data-level="2.4" data-path="tidy-formatted-cells.html"><a href="tidy-formatted-cells.html"><i class="fa fa-check"></i><b>2.4</b> Meaningfully formatted cells</a></li>
<li class="chapter" data-level="2.5" data-path="layered-formatting.html"><a href="layered-formatting.html"><i class="fa fa-check"></i><b>2.5</b> Layered meaningful formatting</a></li>
<li class="chapter" data-level="2.6" data-path="hierarchies-in-formatting.html"><a href="hierarchies-in-formatting.html"><i class="fa fa-check"></i><b>2.6</b> Hierarchies in formatting</a></li>
<li class="chapter" data-level="2.7" data-path="tidy-sentinel.html"><a href="tidy-sentinel.html"><i class="fa fa-check"></i><b>2.7</b> Sentinel values in non-text columns</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="pivot.html"><a href="pivot.html"><i class="fa fa-check"></i><b>3</b> Pivot tables</a><ul>
<li class="chapter" data-level="3.1" data-path="pivot-simple.html"><a href="pivot-simple.html"><i class="fa fa-check"></i><b>3.1</b> Simple unpivoting</a><ul>
<li class="chapter" data-level="3.1.1" data-path="pivot-simple.html"><a href="pivot-simple.html#two-clear-rows-of-text-column-headers-left-aligned"><i class="fa fa-check"></i><b>3.1.1</b> Two clear rows of text column headers, left-aligned</a></li>
<li class="chapter" data-level="3.1.2" data-path="pivot-simple.html"><a href="pivot-simple.html#two-clear-rows-and-columns-of-text-headers-top-aligned-and-left-aligned"><i class="fa fa-check"></i><b>3.1.2</b> Two clear rows and columns of text headers, top-aligned and left-aligned</a></li>
<li class="chapter" data-level="3.1.3" data-path="pivot-simple.html"><a href="pivot-simple.html#multiple-rows-or-columns-of-headers-with-meaningful-formatting"><i class="fa fa-check"></i><b>3.1.3</b> Multiple rows or columns of headers, with meaningful formatting</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="pivot-complex.html"><a href="pivot-complex.html"><i class="fa fa-check"></i><b>3.2</b> Complex unpivoting</a><ul>
<li class="chapter" data-level="3.2.1" data-path="pivot-complex.html"><a href="pivot-complex.html#two-clear-rows-of-text-column-headers-left-aligned-2rl"><i class="fa fa-check"></i><b>3.2.1</b> Two clear rows of text column headers, left-aligned {#2RL}</a></li>
<li class="chapter" data-level="3.2.2" data-path="pivot-complex.html"><a href="pivot-complex.html#two-clear-columns-of-text-row-headers-top-aligned"><i class="fa fa-check"></i><b>3.2.2</b> Two clear columns of text row headers, top-aligned</a></li>
<li class="chapter" data-level="3.2.3" data-path="pivot-complex.html"><a href="pivot-complex.html#two-clear-rows-and-columns-of-text-headers-top-aligned-and-left-aligned-1"><i class="fa fa-check"></i><b>3.2.3</b> Two clear rows and columns of text headers, top-aligned and left-aligned</a></li>
<li class="chapter" data-level="3.2.4" data-path="pivot-complex.html"><a href="pivot-complex.html#centre-aligned-headers"><i class="fa fa-check"></i><b>3.2.4</b> Centre-aligned headers</a></li>
<li class="chapter" data-level="3.2.5" data-path="pivot-complex.html"><a href="pivot-complex.html#multiple-rows-or-columns-of-headers-with-meaningful-formatting-1"><i class="fa fa-check"></i><b>3.2.5</b> Multiple rows or columns of headers, with meaningful formatting</a></li>
<li class="chapter" data-level="3.2.6" data-path="pivot-complex.html"><a href="pivot-complex.html#mixed-headers-and-notes-in-the-same-rowcolumn-distinguished-by-formatting"><i class="fa fa-check"></i><b>3.2.6</b> Mixed headers and notes in the same row/column, distinguished by formatting</a></li>
<li class="chapter" data-level="3.2.7" data-path="pivot-complex.html"><a href="pivot-complex.html#mixed-levels-of-headers-in-the-same-rowcolumn-distinguished-by-formatting"><i class="fa fa-check"></i><b>3.2.7</b> Mixed levels of headers in the same row/column, distinguished by formatting</a></li>
<li class="chapter" data-level="3.2.8" data-path="pivot-complex.html"><a href="pivot-complex.html#repeated-rowscolumns-of-headers-within-the-table"><i class="fa fa-check"></i><b>3.2.8</b> Repeated rows/columns of headers within the table</a></li>
<li class="chapter" data-level="3.2.9" data-path="pivot-complex.html"><a href="pivot-complex.html#headers-amongst-the-data"><i class="fa fa-check"></i><b>3.2.9</b> Headers amongst the data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="small-multiples.html"><a href="small-multiples.html"><i class="fa fa-check"></i><b>4</b> Small multiples</a><ul>
<li class="chapter" data-level="4.1" data-path="small-multiples-with-all-headers-present-for-each-multiple.html"><a href="small-multiples-with-all-headers-present-for-each-multiple.html"><i class="fa fa-check"></i><b>4.1</b> Small multiples with all headers present for each multiple</a></li>
<li class="chapter" data-level="4.2" data-path="same-table-in-several-worksheetsfiles-using-the-sheetfile-name.html"><a href="same-table-in-several-worksheetsfiles-using-the-sheetfile-name.html"><i class="fa fa-check"></i><b>4.2</b> Same table in several worksheets/files (using the sheet/file name)</a></li>
<li class="chapter" data-level="4.3" data-path="same-table-in-several-worksheetsfiles-but-in-different-positions.html"><a href="same-table-in-several-worksheetsfiles-but-in-different-positions.html"><i class="fa fa-check"></i><b>4.3</b> Same table in several worksheets/files but in different positions</a></li>
<li class="chapter" data-level="4.4" data-path="implied-multiples.html"><a href="implied-multiples.html"><i class="fa fa-check"></i><b>4.4</b> Implied multiples</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="formatting.html"><a href="formatting.html"><i class="fa fa-check"></i><b>5</b> Formatting</a><ul>
<li class="chapter" data-level="5.1" data-path="an-example-formatting-lookup.html"><a href="an-example-formatting-lookup.html"><i class="fa fa-check"></i><b>5.1</b> An example formatting lookup</a></li>
<li class="chapter" data-level="5.2" data-path="common-formats.html"><a href="common-formats.html"><i class="fa fa-check"></i><b>5.2</b> Common formats</a></li>
<li class="chapter" data-level="5.3" data-path="in-cell-formatting.html"><a href="in-cell-formatting.html"><i class="fa fa-check"></i><b>5.3</b> In-cell formatting</a></li>
<li class="chapter" data-level="5.4" data-path="multiple-pieces-of-information-in-a-single-cell-with-meaningful-formatting.html"><a href="multiple-pieces-of-information-in-a-single-cell-with-meaningful-formatting.html"><i class="fa fa-check"></i><b>5.4</b> Multiple pieces of information in a single cell, with meaningful formatting</a></li>
<li class="chapter" data-level="5.5" data-path="superscript-symbols.html"><a href="superscript-symbols.html"><i class="fa fa-check"></i><b>5.5</b> Superscript symbols</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="data-validation.html"><a href="data-validation.html"><i class="fa fa-check"></i><b>6</b> Data validation</a></li>
<li class="chapter" data-level="7" data-path="formulas.html"><a href="formulas.html"><i class="fa fa-check"></i><b>7</b> Formulas</a></li>
<li class="chapter" data-level="8" data-path="other-gotchas.html"><a href="other-gotchas.html"><i class="fa fa-check"></i><b>8</b> Other gotchas</a><ul>
<li class="chapter" data-level="8.1" data-path="non-text-headers-e-g-dates.html"><a href="non-text-headers-e-g-dates.html"><i class="fa fa-check"></i><b>8.1</b> Non-text headers e.g. dates</a></li>
<li class="chapter" data-level="8.2" data-path="data-embedded-in-comments.html"><a href="data-embedded-in-comments.html"><i class="fa fa-check"></i><b>8.2</b> Data embedded in comments</a></li>
<li class="chapter" data-level="8.3" data-path="named-ranges.html"><a href="named-ranges.html"><i class="fa fa-check"></i><b>8.3</b> Named ranges</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="case-studies.html"><a href="case-studies.html"><i class="fa fa-check"></i><b>9</b> Case studies</a><ul>
<li class="chapter" data-level="9.1" data-path="australian-marriage-survey.html"><a href="australian-marriage-survey.html"><i class="fa fa-check"></i><b>9.1</b> Australian Marriage Survey</a><ul>
<li class="chapter" data-level="9.1.1" data-path="australian-marriage-survey.html"><a href="australian-marriage-survey.html#the-full-code-listing"><i class="fa fa-check"></i><b>9.1.1</b> The full code listing</a></li>
<li class="chapter" data-level="9.1.2" data-path="australian-marriage-survey.html"><a href="australian-marriage-survey.html#step-by-step"><i class="fa fa-check"></i><b>9.1.2</b> Step by step</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="vaccinations.html"><a href="vaccinations.html"><i class="fa fa-check"></i><b>9.2</b> Vaccinations</a></li>
<li class="chapter" data-level="9.3" data-path="us-crime.html"><a href="us-crime.html"><i class="fa fa-check"></i><b>9.3</b> US Crime</a><ul>
<li class="chapter" data-level="9.3.1" data-path="us-crime.html"><a href="us-crime.html#us-crime-2"><i class="fa fa-check"></i><b>9.3.1</b> Table 2</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="toronto-transit-commission.html"><a href="toronto-transit-commission.html"><i class="fa fa-check"></i><b>9.4</b> Toronto Transit Commission</a><ul>
<li class="chapter" data-level="9.4.1" data-path="toronto-transit-commission.html"><a href="toronto-transit-commission.html#the-full-code-listing-1"><i class="fa fa-check"></i><b>9.4.1</b> The full code listing</a></li>
<li class="chapter" data-level="9.4.2" data-path="toronto-transit-commission.html"><a href="toronto-transit-commission.html#step-by-step-1"><i class="fa fa-check"></i><b>9.4.2</b> Step by step</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Spreadsheet Munging Strategies</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="us-crime" class="section level2">
<h2><span class="header-section-number">9.3</span> US Crime</h2>
<p><a href="https://twitter.com/albertocairo/status/963133927530483712"><img src="images/us-crime-tweet.jpg" alt="Tweet by Alberto Cairo about a spreadsheet that violates Hadley Wickham’s principles of tidy data" /></a></p>
<p>These are two tables of numbers of crimes in the USA, by state and category of
crime. Confusingly, they’re numbered Table 2 and Table 3. Table 1 exists but
isn’t included in this case study because it is so straightforward.</p>
<div id="us-crime-2" class="section level3">
<h3><span class="header-section-number">9.3.1</span> Table 2</h3>
<p><img src="images/us-crime-2.jpg" /></p>
<div id="us-crime-2-simple" class="section level4">
<h4><span class="header-section-number">9.3.1.1</span> Simple version</h4>
<p>This is straightforward to import as long as you don’t care to organise the
hierarchies of crimes and areas. For example, Conneticut is within the division
New England, which itself is within the region Northeast, but if you don’t need
to express those relationships in the data then you can ignore the bold
formatting.</p>
<p>The only slight snag is that the header cells in row 5 are blank. There is a
header for the units “Rate per 100,000”, but no header for the units “Count” –
the cells in those positions are empty. It would be a problem if the cells
didn’t exist at all, because <code>behead(&quot;N&quot;, &quot;unit&quot;)</code> wouldn’t be able to associate
data cells with missing header cells. Fortunately they do exist (because they
have formatting), they are just empty or <code>NA</code>. To make sure they aren’t
ignored, use <code>drop_na = FALSE</code> in <code>behead()</code>, and then later fill the blanks in
the <code>units</code> column with <code>&quot;Count&quot;</code>.</p>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb341-1" data-line-number="1">cells &lt;-</a>
<a class="sourceLine" id="cb341-2" data-line-number="2"><span class="st">  </span><span class="kw">xlsx_cells</span>(smungs<span class="op">::</span>us_crime_<span class="dv">2</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb341-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">character =</span> <span class="kw">map_chr</span>(character_formatted,</a>
<a class="sourceLine" id="cb341-4" data-line-number="4">                             <span class="op">~</span><span class="st"> </span><span class="kw">ifelse</span>(<span class="kw">is.null</span>(.x), character, .x<span class="op">$</span>character[<span class="dv">1</span>])),</a>
<a class="sourceLine" id="cb341-5" data-line-number="5">         <span class="dt">character =</span> <span class="kw">str_replace_all</span>(character, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="st">&quot; &quot;</span>))</a>
<a class="sourceLine" id="cb341-6" data-line-number="6"></a>
<a class="sourceLine" id="cb341-7" data-line-number="7">cells <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb341-8" data-line-number="8"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(row <span class="op">&gt;=</span><span class="st"> </span>4L) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb341-9" data-line-number="9"><span class="st">  </span><span class="kw">select</span>(row, col, data_type, character, numeric) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb341-10" data-line-number="10"><span class="st">  </span><span class="kw">behead</span>(<span class="st">&quot;NNW&quot;</span>, <span class="st">&quot;crime&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb341-11" data-line-number="11"><span class="st">  </span><span class="kw">behead</span>(<span class="st">&quot;N&quot;</span>, <span class="st">&quot;unit&quot;</span>, <span class="dt">drop_na =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb341-12" data-line-number="12"><span class="st">  </span><span class="kw">behead</span>(<span class="st">&quot;WNW&quot;</span>, <span class="st">&quot;area&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb341-13" data-line-number="13"><span class="st">  </span><span class="kw">behead</span>(<span class="st">&quot;W&quot;</span>, <span class="st">&quot;year&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb341-14" data-line-number="14"><span class="st">  </span><span class="kw">behead</span>(<span class="st">&quot;W&quot;</span>, <span class="st">&quot;population&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb341-15" data-line-number="15"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(year <span class="op">!=</span><span class="st"> &quot;Percent change&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb341-16" data-line-number="16"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">unit =</span> <span class="kw">if_else</span>(unit <span class="op">==</span><span class="st"> &quot;&quot;</span>, <span class="st">&quot;Count&quot;</span>, unit)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb341-17" data-line-number="17"><span class="st">  </span><span class="kw">select</span>(row, data_type, numeric, unit, area, year, population, crime) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb341-18" data-line-number="18"><span class="st">  </span><span class="kw">spatter</span>(unit) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb341-19" data-line-number="19"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>row)</a></code></pre></div>
<pre><code>## # A tibble: 1,320 x 6
##    area                year  population crime       Count `Rate per  100,…
##    &lt;chr&gt;               &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;       &lt;dbl&gt;            &lt;dbl&gt;
##  1 United States Total 2015  320896618  Aggravate… 7.64e5            238. 
##  2 United States Total 2015  320896618  Burglary   1.59e6            495. 
##  3 United States Total 2015  320896618  Larceny-t… 5.72e6           1784. 
##  4 United States Total 2015  320896618  Motor veh… 7.13e5            222. 
##  5 United States Total 2015  320896618  Murder an… 1.59e4              4.9
##  6 United States Total 2015  320896618  Property … 8.02e6           2500. 
##  7 United States Total 2015  320896618  Rape (leg… 9.13e4             28.4
##  8 United States Total 2015  320896618  Rape (rev… 1.26e5             39.3
##  9 United States Total 2015  320896618  Robbery    3.28e5            102. 
## 10 United States Total 2015  320896618  Violent c… 1.23e6            385. 
## # ... with 1,310 more rows</code></pre>
</div>
<div id="us-crime-2-complex" class="section level4">
<h4><span class="header-section-number">9.3.1.2</span> Complex version</h4>
<p>If you do mind about grouping states within divisions within regions, and
crimes within categories, then you have more work to do using <code>enhead()</code> rather
than <code>behead()</code>.</p>
<ol style="list-style-type: decimal">
<li>Select the header cells at each level of the hierarchy and store them in
their own variables. For example, filter for the bold cells in row 4, which
are the categories of crimes, and store them in the <code>categories</code> variable.</li>
<li>Select the data cells, and use <code>enhead()</code> to join them to the headers.</li>
</ol>
<p>In fact the headers <code>unit</code>, <code>year</code>, <code>population</code> can be handled by <code>behead()</code>,
because they aren’t hierarchichal, so only the variables <code>category</code>, <code>crime</code>,
<code>region</code>, <code>division</code> and <code>state</code> are handled by <code>enhead()</code>.</p>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb343-1" data-line-number="1">cells &lt;-</a>
<a class="sourceLine" id="cb343-2" data-line-number="2"><span class="st">  </span><span class="kw">xlsx_cells</span>(smungs<span class="op">::</span>us_crime_<span class="dv">2</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb343-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">character =</span> <span class="kw">map_chr</span>(character_formatted,</a>
<a class="sourceLine" id="cb343-4" data-line-number="4">                             <span class="op">~</span><span class="st"> </span><span class="kw">ifelse</span>(<span class="kw">is.null</span>(.x), character, .x<span class="op">$</span>character[<span class="dv">1</span>])),</a>
<a class="sourceLine" id="cb343-5" data-line-number="5">         <span class="dt">character =</span> <span class="kw">str_replace_all</span>(character, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="st">&quot; &quot;</span>))</a>
<a class="sourceLine" id="cb343-6" data-line-number="6"></a>
<a class="sourceLine" id="cb343-7" data-line-number="7">formats &lt;-<span class="st"> </span><span class="kw">xlsx_formats</span>(smungs<span class="op">::</span>us_crime_<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb343-8" data-line-number="8"></a>
<a class="sourceLine" id="cb343-9" data-line-number="9">categories &lt;-</a>
<a class="sourceLine" id="cb343-10" data-line-number="10"><span class="st">  </span>cells <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb343-11" data-line-number="11"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(row <span class="op">==</span><span class="st"> </span>4L,</a>
<a class="sourceLine" id="cb343-12" data-line-number="12">                data_type <span class="op">==</span><span class="st"> &quot;character&quot;</span>,</a>
<a class="sourceLine" id="cb343-13" data-line-number="13">                formats<span class="op">$</span>local<span class="op">$</span>font<span class="op">$</span>bold[local_format_id]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb343-14" data-line-number="14"><span class="st">  </span><span class="kw">select</span>(row, col, <span class="dt">category =</span> character)</a>
<a class="sourceLine" id="cb343-15" data-line-number="15">categories</a></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##     row   col category      
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;         
## 1     4     4 Violent crime 
## 2     4    16 Property crime</code></pre>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb345-1" data-line-number="1">crimes &lt;-</a>
<a class="sourceLine" id="cb345-2" data-line-number="2"><span class="st">  </span>cells <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb345-3" data-line-number="3"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(row <span class="op">==</span><span class="st"> </span>4L, data_type <span class="op">==</span><span class="st"> &quot;character&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb345-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">character =</span> <span class="kw">if_else</span>(character <span class="op">%in%</span><span class="st"> </span>categories<span class="op">$</span>category,</a>
<a class="sourceLine" id="cb345-5" data-line-number="5">                             <span class="st">&quot;Total&quot;</span>,</a>
<a class="sourceLine" id="cb345-6" data-line-number="6">                             character)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb345-7" data-line-number="7"><span class="st">  </span><span class="kw">select</span>(row, col, <span class="dt">crime =</span> character)</a>
<a class="sourceLine" id="cb345-8" data-line-number="8">crimes</a></code></pre></div>
<pre><code>## # A tibble: 13 x 3
##      row   col crime                                 
##    &lt;int&gt; &lt;int&gt; &lt;chr&gt;                                 
##  1     4     1 Area                                  
##  2     4     2 Year                                  
##  3     4     3 Population                            
##  4     4     4 Total                                 
##  5     4     6 Murder and  nonnegligent  manslaughter
##  6     4     8 Rape (revised definition)             
##  7     4    10 Rape (legacy definition)              
##  8     4    12 Robbery                               
##  9     4    14 Aggravated assault                    
## 10     4    16 Total                                 
## 11     4    18 Burglary                              
## 12     4    20 Larceny-theft                         
## 13     4    22 Motor vehicle theft</code></pre>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb347-1" data-line-number="1">regions &lt;-</a>
<a class="sourceLine" id="cb347-2" data-line-number="2"><span class="st">  </span>cells <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb347-3" data-line-number="3"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(row <span class="op">&gt;=</span><span class="st"> </span>6L,</a>
<a class="sourceLine" id="cb347-4" data-line-number="4">                col <span class="op">==</span><span class="st"> </span>1L,</a>
<a class="sourceLine" id="cb347-5" data-line-number="5">                data_type <span class="op">==</span><span class="st"> &quot;character&quot;</span>,</a>
<a class="sourceLine" id="cb347-6" data-line-number="6">                formats<span class="op">$</span>local<span class="op">$</span>font<span class="op">$</span>bold[local_format_id]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb347-7" data-line-number="7"><span class="st">  </span><span class="kw">select</span>(row, col, <span class="dt">region =</span> character)</a>
<a class="sourceLine" id="cb347-8" data-line-number="8">regions</a></code></pre></div>
<pre><code>## # A tibble: 5 x 3
##     row   col region             
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;              
## 1     6     1 United States Total
## 2     9     1 Northeast          
## 3    45     1 Midwest            
## 4    90     1 South              
## 5   153     1 West</code></pre>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb349-1" data-line-number="1">divisions &lt;-</a>
<a class="sourceLine" id="cb349-2" data-line-number="2"><span class="st">  </span>cells <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb349-3" data-line-number="3"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(row <span class="op">&gt;=</span><span class="st"> </span>6L,</a>
<a class="sourceLine" id="cb349-4" data-line-number="4">                col <span class="op">==</span><span class="st"> </span>1L,</a>
<a class="sourceLine" id="cb349-5" data-line-number="5">                data_type <span class="op">==</span><span class="st"> &quot;character&quot;</span>,</a>
<a class="sourceLine" id="cb349-6" data-line-number="6">                <span class="op">!</span>formats<span class="op">$</span>local<span class="op">$</span>font<span class="op">$</span>bold[local_format_id],</a>
<a class="sourceLine" id="cb349-7" data-line-number="7">                <span class="op">!</span><span class="kw">str_detect</span>(character, <span class="st">&quot;^ {5}&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb349-8" data-line-number="8"><span class="st">  </span><span class="kw">select</span>(row, col, <span class="dt">division =</span> character)</a>
<a class="sourceLine" id="cb349-9" data-line-number="9">divisions</a></code></pre></div>
<pre><code>## # A tibble: 21 x 3
##      row   col division          
##    &lt;int&gt; &lt;int&gt; &lt;chr&gt;             
##  1    12     1 New England       
##  2    33     1 Middle Atlantic   
##  3    48     1 East North Central
##  4    66     1 West North Central
##  5    93     1 South Atlantic    
##  6   123     1 East South Central
##  7   138     1 West South Central
##  8   156     1 Mountain          
##  9   183     1 Pacific           
## 10   201     1 Puerto Rico       
## # ... with 11 more rows</code></pre>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb351-1" data-line-number="1">states &lt;-</a>
<a class="sourceLine" id="cb351-2" data-line-number="2"><span class="st">  </span>cells <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb351-3" data-line-number="3"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(row <span class="op">&gt;=</span><span class="st"> </span>6L,</a>
<a class="sourceLine" id="cb351-4" data-line-number="4">                col <span class="op">==</span><span class="st"> </span>1L,</a>
<a class="sourceLine" id="cb351-5" data-line-number="5">                data_type <span class="op">==</span><span class="st"> &quot;character&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb351-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">character =</span> <span class="kw">if_else</span>(<span class="kw">str_detect</span>(character, <span class="st">&quot;^ {5}&quot;</span>),</a>
<a class="sourceLine" id="cb351-7" data-line-number="7">                             <span class="kw">str_trim</span>(character),</a>
<a class="sourceLine" id="cb351-8" data-line-number="8">                             <span class="st">&quot;Total&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb351-9" data-line-number="9"><span class="st">  </span><span class="kw">select</span>(row, col, <span class="dt">state =</span> character)</a>
<a class="sourceLine" id="cb351-10" data-line-number="10">states</a></code></pre></div>
<pre><code>## # A tibble: 77 x 3
##      row   col state        
##    &lt;int&gt; &lt;int&gt; &lt;chr&gt;        
##  1     6     1 Total        
##  2     9     1 Total        
##  3    12     1 Total        
##  4    15     1 Connecticut  
##  5    18     1 Maine        
##  6    21     1 Massachusetts
##  7    24     1 New Hampshire
##  8    27     1 Rhode Island 
##  9    30     1 Vermont      
## 10    33     1 Total        
## # ... with 67 more rows</code></pre>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb353-1" data-line-number="1">cells <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb353-2" data-line-number="2"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(row <span class="op">&gt;=</span><span class="st"> </span>5L, col <span class="op">&gt;=</span><span class="st"> </span>2L) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb353-3" data-line-number="3"><span class="st">  </span><span class="kw">select</span>(row, col, data_type, character, numeric) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb353-4" data-line-number="4"><span class="st">  </span><span class="kw">behead</span>(<span class="st">&quot;N&quot;</span>, <span class="st">&quot;unit&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb353-5" data-line-number="5"><span class="st">  </span><span class="kw">behead</span>(<span class="st">&quot;W&quot;</span>, <span class="st">&quot;year&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb353-6" data-line-number="6"><span class="st">  </span><span class="kw">behead</span>(<span class="st">&quot;W&quot;</span>, <span class="st">&quot;population&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb353-7" data-line-number="7"><span class="st">  </span><span class="kw">enhead</span>(categories, <span class="st">&quot;NNW&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb353-8" data-line-number="8"><span class="st">  </span><span class="kw">enhead</span>(crimes, <span class="st">&quot;NNW&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb353-9" data-line-number="9"><span class="st">  </span><span class="kw">enhead</span>(regions, <span class="st">&quot;WNW&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb353-10" data-line-number="10"><span class="st">  </span><span class="kw">enhead</span>(divisions, <span class="st">&quot;WNW&quot;</span>, <span class="dt">drop =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb353-11" data-line-number="11"><span class="st">  </span><span class="kw">enhead</span>(states, <span class="st">&quot;WNW&quot;</span>, <span class="dt">drop =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb353-12" data-line-number="12"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(year <span class="op">!=</span><span class="st"> &quot;Percent change&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb353-13" data-line-number="13"><span class="st">  </span><span class="kw">select</span>(<span class="dt">value =</span> numeric, category, crime, region, division, state, year, population)</a></code></pre></div>
<pre><code>## # A tibble: 2,640 x 8
##      value category      crime      region division state year  population
##      &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;      &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;     
##  1 42121   Violent crime Total      North… New Eng… Total 2015  14710229  
##  2   286.  Violent crime Total      North… New Eng… Total 2015  14710229  
##  3 41598   Violent crime Total      North… New Eng… Total 2016  14735525  
##  4   282.  Violent crime Total      North… New Eng… Total 2016  14735525  
##  5   326   Violent crime Murder an… North… New Eng… Total 2015  14710229  
##  6     2.2 Violent crime Murder an… North… New Eng… Total 2015  14710229  
##  7   292   Violent crime Murder an… North… New Eng… Total 2016  14735525  
##  8     2   Violent crime Murder an… North… New Eng… Total 2016  14735525  
##  9  4602   Violent crime Rape (rev… North… New Eng… Total 2015  14710229  
## 10    31.3 Violent crime Rape (rev… North… New Eng… Total 2015  14710229  
## # ... with 2,630 more rows</code></pre>
</div>
<div id="us-crime-3" class="section level4">
<h4><span class="header-section-number">9.3.1.3</span> Table 3</h4>
<p><img src="images/us-crime-3.jpg" /></p>
<p>This table is confusing to humans, let alone computers. The <code>Population</code> column
seems to belong to a different table altogether, so that’s how we’ll treat it.</p>
<ol style="list-style-type: decimal">
<li>Import the <code>Population</code> column and the state/area headers to the left.</li>
<li>Import the crime-related column headers, and the state/area headers to the left.</li>
<li>Join the two datasets.</li>
</ol>
<p>The <code>statistic</code> header ends up having blank values due to the cells being blank,
so these are manually filled in.</p>
<p>The hierarchy of crime (e.g. ‘robbery’ is within ‘violent crime’) is ignored.
That would be handled in the same way as for <a href="us-crime.html#us-crime-2">Table 2</a>.</p>
<div class="sourceCode" id="cb355"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb355-1" data-line-number="1">cells &lt;-</a>
<a class="sourceLine" id="cb355-2" data-line-number="2"><span class="st">  </span><span class="kw">xlsx_cells</span>(smungs<span class="op">::</span>us_crime_<span class="dv">3</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb355-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">character =</span> <span class="kw">map_chr</span>(character_formatted,</a>
<a class="sourceLine" id="cb355-4" data-line-number="4">                             <span class="op">~</span><span class="st"> </span><span class="kw">ifelse</span>(<span class="kw">is.null</span>(.x), character, .x<span class="op">$</span>character[<span class="dv">1</span>])),</a>
<a class="sourceLine" id="cb355-5" data-line-number="5">         <span class="dt">character =</span> <span class="kw">str_replace_all</span>(character, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="st">&quot; &quot;</span>))</a>
<a class="sourceLine" id="cb355-6" data-line-number="6"></a>
<a class="sourceLine" id="cb355-7" data-line-number="7">population &lt;-</a>
<a class="sourceLine" id="cb355-8" data-line-number="8"><span class="st">  </span>cells <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb355-9" data-line-number="9"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(row <span class="op">&gt;=</span><span class="st"> </span>5L, col <span class="op">&lt;=</span><span class="st"> </span>4L) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb355-10" data-line-number="10"><span class="st">  </span><span class="kw">behead</span>(<span class="st">&quot;WNW&quot;</span>, <span class="st">&quot;state&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb355-11" data-line-number="11"><span class="st">  </span><span class="kw">behead</span>(<span class="st">&quot;WNW&quot;</span>, <span class="st">&quot;area&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb355-12" data-line-number="12"><span class="st">  </span><span class="kw">behead</span>(<span class="st">&quot;W&quot;</span>, <span class="st">&quot;statistic&quot;</span>, <span class="dt">drop_na =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb355-13" data-line-number="13"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">statistic =</span> <span class="kw">case_when</span>(<span class="kw">is.na</span>(statistic) <span class="op">~</span><span class="st"> &quot;Population&quot;</span>,</a>
<a class="sourceLine" id="cb355-14" data-line-number="14">                               statistic <span class="op">==</span><span class="st"> &quot;&quot;</span> <span class="op">~</span><span class="st"> &quot;Population&quot;</span>,</a>
<a class="sourceLine" id="cb355-15" data-line-number="15">                               <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span><span class="kw">str_trim</span>(statistic))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb355-16" data-line-number="16"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(data_type <span class="op">==</span><span class="st"> &quot;numeric&quot;</span>,</a>
<a class="sourceLine" id="cb355-17" data-line-number="17">                <span class="op">!</span><span class="kw">str_detect</span>(area, <span class="kw">regex</span>(<span class="st">&quot;total&quot;</span>, <span class="dt">ignore_case =</span> <span class="ot">TRUE</span>)),</a>
<a class="sourceLine" id="cb355-18" data-line-number="18">                statistic <span class="op">!=</span><span class="st"> &quot;Estimated total&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb355-19" data-line-number="19"><span class="st">  </span><span class="kw">select</span>(data_type, numeric, state, area, statistic) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb355-20" data-line-number="20"><span class="st">  </span><span class="kw">spatter</span>(statistic)</a>
<a class="sourceLine" id="cb355-21" data-line-number="21"></a>
<a class="sourceLine" id="cb355-22" data-line-number="22">crime &lt;-</a>
<a class="sourceLine" id="cb355-23" data-line-number="23"><span class="st">  </span>cells <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb355-24" data-line-number="24"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(row <span class="op">&gt;=</span><span class="st"> </span><span class="dv">4</span>, col <span class="op">!=</span><span class="st"> </span>5L) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb355-25" data-line-number="25"><span class="st">  </span><span class="kw">behead</span>(<span class="st">&quot;WNW&quot;</span>, <span class="st">&quot;state&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb355-26" data-line-number="26"><span class="st">  </span><span class="kw">behead</span>(<span class="st">&quot;WNW&quot;</span>, <span class="st">&quot;area&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb355-27" data-line-number="27"><span class="st">  </span><span class="kw">behead</span>(<span class="st">&quot;W&quot;</span>, <span class="st">&quot;statistic&quot;</span>, <span class="dt">formatters =</span> <span class="kw">list</span>(<span class="dt">character =</span> str_trim)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb355-28" data-line-number="28"><span class="st">  </span><span class="kw">behead</span>(<span class="st">&quot;N&quot;</span>, <span class="st">&quot;crime&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb355-29" data-line-number="29"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(data_type <span class="op">==</span><span class="st"> &quot;numeric&quot;</span>,</a>
<a class="sourceLine" id="cb355-30" data-line-number="30">                <span class="op">!</span><span class="kw">str_detect</span>(area, <span class="kw">regex</span>(<span class="st">&quot;total&quot;</span>, <span class="dt">ignore_case =</span> <span class="ot">TRUE</span>)),</a>
<a class="sourceLine" id="cb355-31" data-line-number="31">                <span class="op">!</span><span class="kw">is.na</span>(statistic),</a>
<a class="sourceLine" id="cb355-32" data-line-number="32">                statistic <span class="op">!=</span><span class="st"> &quot;&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb355-33" data-line-number="33"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">statistic =</span> <span class="kw">case_when</span>(statistic <span class="op">==</span><span class="st"> &quot;Area actually reporting&quot;</span> <span class="op">~</span><span class="st"> &quot;Actual&quot;</span>,</a>
<a class="sourceLine" id="cb355-34" data-line-number="34">                               statistic <span class="op">==</span><span class="st"> &quot;Estimated total&quot;</span> <span class="op">~</span><span class="st"> &quot;Estimated&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb355-35" data-line-number="35"><span class="st">  </span><span class="kw">select</span>(data_type, numeric, state, area, statistic, crime) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb355-36" data-line-number="36"><span class="st">  </span><span class="kw">spatter</span>(statistic)</a>
<a class="sourceLine" id="cb355-37" data-line-number="37"></a>
<a class="sourceLine" id="cb355-38" data-line-number="38"><span class="kw">left_join</span>(population, crime)</a></code></pre></div>
<pre><code>## Joining, by = c(&quot;state&quot;, &quot;area&quot;)</code></pre>
<pre><code>## # A tibble: 1,480 x 7
##    state   area     `Area actually r… Population crime    Actual Estimated
##    &lt;chr&gt;   &lt;chr&gt;                &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt;
##  1 ALABAMA Cities …             0.966     520422 Aggrav… 2.84e+3      2914
##  2 ALABAMA Cities …             0.966     520422 Burgla… 4.17e+3      4275
##  3 ALABAMA Cities …             0.966     520422 Larcen… 1.43e+4     14641
##  4 ALABAMA Cities …             0.966     520422 Motor … 1.34e+3      1375
##  5 ALABAMA Cities …             0.966     520422 Murder… 4.10e+1        42
##  6 ALABAMA Cities …             0.966     520422 Popula… 9.66e-1         1
##  7 ALABAMA Cities …             0.966     520422 Proper… 1.98e+4     20291
##  8 ALABAMA Cities …             0.966     520422 Rape (… 1.87e+2       193
##  9 ALABAMA Cities …             0.966     520422 Rape (… 2.63e+2       269
## 10 ALABAMA Cities …             0.966     520422 Robbery 4.10e+2       421
## # ... with 1,470 more rows</code></pre>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="vaccinations.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="toronto-transit-commission.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/nacnudus/spreadsheet-munging-strategies/edit/master/case-studies.Rmd",
"text": "Edit"
},
"download": ["_main.pdf", "_main.epub"],
"toc": {
"collapse": "none"
}
});
});
</script>

</body>

</html>
